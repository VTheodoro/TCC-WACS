<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - WACS</title>
    <link rel="stylesheet" href="../public/css/styles.css">
    <link rel="stylesheet" href="../public/css/core.css">
    <link rel="stylesheet" href="../public/css/theme-switch.css">
    <link rel="stylesheet" href="../public/css/navbar-modern.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="../public/images/logo-light.png" type="image/png">
    <style>
        /* Estilos da navbar compacta */
        #main-nav {
            min-height: 45px;
        }
        
        .navbar-content {
            padding: 0.35rem 0;
        }
        
        .logo img {
            width: 28px;
            height: auto;
        }
        
        .logo {
            margin-right: 0.5rem;
        }
        
        .logo-text {
            font-size: 1.1rem;
        }
        
        .nav-menu {
            margin-left: 0;
        }
        
        .nav-links {
            gap: 0.25rem;
        }
        
        .nav-links li {
            margin: 0 0.2rem;
        }
        
        .nav-links li:first-child {
            margin-left: 0;
        }
        
        .nav-links li a {
            padding: 0.2rem 0.4rem;
            height: 1.8rem;
            font-size: 0.85rem;
        }
        
        .nav-actions {
            gap: 0.35rem;
        }
        
        .theme-toggle {
            transform: scale(0.8);
        }
        
        .logout-btn {
            padding: 0.2rem 0.65rem;
            font-size: 0.8rem;
        }
        
        .menu-toggle {
            width: 20px;
            height: 14px;
        }
        
        .menu-toggle span {
            height: 1.5px;
        }

        /* Ajuste para o espa√ßo do dashboard */
        .dashboard-container {
            padding-top: 45px;
            min-height: calc(100vh - 45px);
            background: var(--background-color, #fff);
        }
        
        body.dark-theme .dashboard-container {
            background: var(--dark-background, #121212);
        }
        
        .dashboard-header {
            background: var(--accent-color, #e0eaff);
            padding: 2rem 0;
        }
        
        body.dark-theme .dashboard-header {
            background: var(--dark-accent, #1E293B);
        }
        
        .dashboard-header h1 {
            color: var(--primary-color, #0055b3);
            margin-bottom: 0.5rem;
            font-size: 1.75rem;
        }
        
        body.dark-theme .dashboard-header h1 {
            color: var(--dark-primary, #4A90E2);
        }
        
        .dashboard-header p {
            color: var(--text-light, #4b5563);
        }
        
        body.dark-theme .dashboard-header p {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .stat-card {
            background: var(--background-color, #fff);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            transition: transform 0.3s ease;
        }
        
        body.dark-theme .stat-card {
            background: var(--dark-card, #1e1e2d);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            background: var(--accent-color, #e0eaff);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: var(--primary-color, #0055b3);
            font-size: 1.5rem;
        }
        
        body.dark-theme .stat-icon {
            background: var(--dark-accent, #1E293B);
            color: var(--dark-primary, #4A90E2);
        }
        
        .stat-content h3 {
            font-size: 0.9rem;
            color: var(--text-light, #4b5563);
            margin-bottom: 0.25rem;
            font-weight: 500;
        }
        
        body.dark-theme .stat-content h3 {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .stat-content p {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-color, #1f2937);
            margin: 0;
        }
        
        body.dark-theme .stat-content p {
            color: var(--dark-text, #e2e8f0);
        }
        
        .dashboard-content {
            padding: 2rem 0;
        }
        
        .dashboard-section {
            margin-bottom: 3rem;
        }
        
        .dashboard-section h2 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--text-color, #1f2937);
        }
        
        body.dark-theme .dashboard-section h2 {
            color: var(--dark-text, #e2e8f0);
        }
        
        .map-container {
            height: 400px;
            background: #f5f5f5;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light, #4b5563);
            font-size: 1.1rem;
        }
        
        body.dark-theme .map-container {
            background: var(--dark-card, #1e1e2d);
            color: var(--dark-text-light, #94a3b8);
        }
        
        .locations-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .location-card {
            background: var(--background-color, #fff);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease;
        }
        
        body.dark-theme .location-card {
            background: var(--dark-card, #1e1e2d);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .location-card:hover {
            transform: translateY(-5px);
        }
        
        .location-image {
            height: 160px;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            overflow: hidden;
        }
        
        .location-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }
        
        .location-card:hover .location-image img {
            transform: scale(1.05);
        }
        
        body.dark-theme .location-image {
            background: #2d3748;
            color: #718096;
        }
        
        .location-details {
            padding: 1.5rem;
        }
        
        .location-details h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: var(--text-color, #1f2937);
        }
        
        body.dark-theme .location-details h3 {
            color: var(--dark-text, #e2e8f0);
        }
        
        .location-details p {
            color: var(--text-light, #4b5563);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }
        
        body.dark-theme .location-details p {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .location-rating {
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
        }
        
        .location-rating i {
            color: #fbbf24;
            font-size: 0.9rem;
            margin-right: 0.25rem;
        }
        
        .location-rating span {
            margin-left: 0.5rem;
            color: var(--text-light, #4b5563);
            font-size: 0.9rem;
        }
        
        body.dark-theme .location-rating span {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            margin-top: 20px;
        }
        
        .user-avatar {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: var(--accent-color, #e0eaff);
            color: var(--primary-color, #0055b3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            text-decoration: none;
        }
        
        .user-avatar:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-theme .user-avatar {
            background: var(--dark-accent, #1E293B);
            color: var(--dark-primary, #4A90E2);
        }
        
        body.dark-theme .user-avatar:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .user-details h2 {
            margin-bottom: 0.25rem;
        }
        
        .user-details p {
            color: var(--text-light, #4b5563);
            margin: 0;
            margin-bottom: 0.5rem;
        }
        
        body.dark-theme .user-details p {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .profile-link {
            display: inline-flex;
            align-items: center;
            color: var(--primary-color, #0055b3);
            font-size: 0.875rem;
            text-decoration: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        
        .profile-link i {
            margin-right: 0.25rem;
        }
        
        .profile-link:hover {
            background-color: var(--accent-color, #e0eaff);
            text-decoration: none;
        }
        
        body.dark-theme .profile-link {
            color: var(--dark-primary, #4A90E2);
        }
        
        body.dark-theme .profile-link:hover {
            background-color: var(--dark-accent, #1E293B);
        }
        
        .logout-btn {
            background: transparent;
            color: var(--primary-color, #0055b3);
            border: 1px solid var(--primary-color, #0055b3);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: auto;
        }
        
        body.dark-theme .logout-btn {
            color: var(--dark-primary, #4A90E2);
            border-color: var(--dark-primary, #4A90E2);
        }
        
        .logout-btn:hover {
            background: var(--primary-color, #0055b3);
            color: white;
        }
        
        body.dark-theme .logout-btn:hover {
            background: var(--dark-primary, #4A90E2);
            color: white;
        }
        
        .add-location-btn {
            display: inline-flex;
            align-items: center;
            background: var(--primary-color, #0055b3);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            margin-top: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        body.dark-theme .add-location-btn {
            background: var(--dark-primary, #4A90E2);
        }
        
        .add-location-btn i {
            margin-right: 0.5rem;
        }
        
        .add-location-btn:hover {
            background: var(--primary-hover, #0066d6);
            transform: translateY(-2px);
        }

        /* Estilos para o menu mobile */
        .mobile-menu {
            padding: 0.5rem;
            margin-top: 0.2rem;
        }
        
        .nav-links-mobile {
            margin: 0 0 0.5rem 0;
        }
        
        .nav-links-mobile li {
            margin-bottom: 0.25rem;
        }
        
        .nav-links-mobile a {
            padding: 0.25rem 0.4rem;
            font-size: 0.85rem;
        }
        
        .download-btn-mobile {
            padding: 0.35rem;
            font-size: 0.8rem;
        }
        
        /* Media queries para telas pequenas */
        @media (max-width: 400px) {
            .logo-text {
                display: none;
            }
            
            .nav-links li a {
                padding: 0.2rem 0.3rem;
            }
        }

        /* Centraliza√ß√£o da navbar */
        #main-nav .container {
            display: flex;
            justify-content: center;
        }
        
        .navbar-content {
            width: 100%;
            max-width: 900px;
            justify-content: space-between;
        }
        
        @media (max-width: 960px) {
            .navbar-content {
                max-width: 100%;
                padding-left: 1rem;
                padding-right: 1rem;
            }
        }

        /* Estilos para o modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(3px);
        }
        
        .modal-content {
            background-color: var(--background-color, #fff);
            margin: 5% auto;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 600px;
            position: relative;
            animation: modalFadeIn 0.3s ease;
        }
        
        body.dark-theme .modal-content {
            background-color: var(--dark-card, #1e1e2d);
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
        }
        
        @keyframes modalFadeIn {
            from {opacity: 0; transform: translateY(-20px);}
            to {opacity: 1; transform: translateY(0);}
        }
        
        .close-modal {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            color: var(--text-light, #4b5563);
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        
        body.dark-theme .close-modal {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .close-modal:hover {
            color: var(--primary-color, #0055b3);
        }
        
        body.dark-theme .close-modal:hover {
            color: var(--dark-primary, #4A90E2);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-color, #1f2937);
        }
        
        body.dark-theme .form-group label {
            color: var(--dark-text, #e2e8f0);
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color, #d1d5db);
            border-radius: 8px;
            background: var(--input-bg, #f9fafb);
            color: var(--text-color, #1f2937);
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        
        body.dark-theme .form-group input,
        body.dark-theme .form-group textarea {
            border-color: var(--dark-border, #2d3748);
            background: var(--dark-input-bg, #1a1a2e);
            color: var(--dark-text, #e2e8f0);
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color, #0055b3);
            box-shadow: 0 0 0 3px rgba(0, 85, 179, 0.1);
        }
        
        body.dark-theme .form-group input:focus,
        body.dark-theme .form-group textarea:focus {
            border-color: var(--dark-primary, #4A90E2);
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.2);
        }
        
        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Estilos para o mapa no formul√°rio */
        .location-map-selector {
            width: 100%;
            height: 300px;
            background-color: #f1f1f1;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        body.dark-theme .location-map-selector {
            background-color: #1a1a2e;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .map-instructions {
            font-size: 0.875rem;
            color: var(--text-light, #4b5563);
            margin-bottom: 1rem;
            font-style: italic;
        }
        
        body.dark-theme .map-instructions {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .coordinates-fields {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .coordinate-field {
            flex: 1;
        }
        
        .coordinate-field label {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .coordinate-field input {
            background-color: var(--accent-color, #e0eaff);
            font-family: monospace;
            text-align: center;
        }
        
        body.dark-theme .coordinate-field input {
            background-color: var(--dark-accent, #1E293B);
        }
        
        .map-marker-pulse {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color, #0055b3);
            position: absolute;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }
        
        .map-marker-pulse:before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            background: rgba(0, 85, 179, 0.4);
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(3); opacity: 0; }
        }
        
        .submit-btn {
            background: var(--primary-color, #0055b3);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            width: 100%;
        }
        
        body.dark-theme .submit-btn {
            background: var(--dark-primary, #4A90E2);
        }
        
        .submit-btn:hover {
            background: var(--primary-hover, #0066d6);
            transform: translateY(-2px);
        }
        
        /* Mensagens de feedback */
        .no-locations, .load-error {
            padding: 2rem;
            text-align: center;
            background: var(--accent-color, #e0eaff);
            border-radius: 12px;
            color: var(--text-color, #1f2937);
            width: 100%;
            margin-bottom: 1.5rem;
        }
        
        body.dark-theme .no-locations, 
        body.dark-theme .load-error {
            background: var(--dark-accent, #1E293B);
            color: var(--dark-text, #e2e8f0);
        }
        
        .load-error {
            background: #fee2e2;
            color: #991b1b;
        }
        
        body.dark-theme .load-error {
            background: #7f1d1d;
            color: #fecaca;
        }
        
        /* Estilos para a janela de informa√ß√µes do mapa */
        .map-info-window {
            padding: 8px;
            max-width: 300px;
        }
        
        .map-info-window h3 {
            margin: 0 0 8px 0;
            font-size: 16px;
            color: var(--primary-color, #0055b3);
        }
        
        .map-info-window p {
            margin: 0 0 6px 0;
            font-size: 14px;
            color: var(--text-color, #1f2937);
        }
        
        body.dark-theme .map-info-window {
            background-color: var(--dark-card, #1e1e2d);
            color: var(--dark-text, #e2e8f0);
        }
        
        /* Estilos para o sistema de avalia√ß√£o */
        .rating-stars {
            display: flex;
            gap: 0.5rem;
            font-size: 1.5rem;
            margin: 0.5rem 0;
        }
        
        .rating-stars i {
            cursor: pointer;
            color: #d1d5db;
            transition: all 0.2s ease;
        }
        
        body.dark-theme .rating-stars i {
            color: #4b5563;
        }
        
        .rating-stars i:hover,
        .rating-stars i.fas {
            color: #fbbf24;
        }
        
        .rating-stars i:hover ~ i {
            color: #d1d5db;
        }
        
        body.dark-theme .rating-stars i:hover ~ i {
            color: #4b5563;
        }
        
        #locationToRate {
            background-color: var(--accent-color, #e0eaff);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        
        body.dark-theme #locationToRate {
            background-color: var(--dark-accent, #1E293B);
        }
        
        #locationToRate h3 {
            margin-top: 0;
            margin-bottom: 0.5rem;
            color: var(--primary-color, #0055b3);
        }
        
        body.dark-theme #locationToRate h3 {
            color: var(--dark-primary, #4A90E2);
        }
        
        #locationToRate p {
            margin: 0.25rem 0;
            color: var(--text-light, #4b5563);
        }
        
        body.dark-theme #locationToRate p {
            color: var(--dark-text-light, #94a3b8);
        }
        
        /* Estilos para reviews em cards de locais */
        .location-reviews {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color, #e5e7eb);
        }
        
        body.dark-theme .location-reviews {
            border-color: var(--dark-border, #2d3748);
        }
        
        .review-item {
            margin-bottom: 0.75rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px dashed var(--border-color, #e5e7eb);
        }
        
        body.dark-theme .review-item {
            border-color: var(--dark-border, #2d3748);
        }
        
        .review-item:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        
        .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.25rem;
        }
        
        .review-author {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-color, #1f2937);
        }
        
        body.dark-theme .review-author {
            color: var(--dark-text, #e2e8f0);
        }
        
        .review-date {
            font-size: 0.75rem;
            color: var(--text-light, #6b7280);
        }
        
        body.dark-theme .review-date {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .review-stars {
            display: flex;
            gap: 0.1rem;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }
        
        .review-stars i.fas {
            color: #fbbf24;
        }
        
        .review-stars i.far {
            color: #d1d5db;
        }
        
        body.dark-theme .review-stars i.far {
            color: #4b5563;
        }
        
        .review-text {
            font-size: 0.875rem;
            color: var(--text-light, #4b5563);
            margin: 0.25rem 0 0 0;
        }
        
        body.dark-theme .review-text {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .rate-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--accent-color, #e0eaff);
            color: var(--primary-color, #0055b3);
            border: none;
            padding: 0.35rem 0.75rem;
            font-size: 0.875rem;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 0.5rem;
            transition: all 0.3s ease;
        }
        
        body.dark-theme .rate-button {
            background-color: var(--dark-accent, #1E293B);
            color: var(--dark-primary, #4A90E2);
        }
        
        .rate-button:hover {
            background-color: var(--primary-color, #0055b3);
            color: white;
        }
        
        body.dark-theme .rate-button:hover {
            background-color: var(--dark-primary, #4A90E2);
            color: white;
        }
        
        .rate-button i {
            margin-right: 0.25rem;
        }
        
        .review-summary {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }
        
        .show-reviews-button {
            background: none;
            border: none;
            color: var(--primary-color, #0055b3);
            font-size: 0.875rem;
            cursor: pointer;
            padding: 0;
            text-decoration: underline;
        }
        
        body.dark-theme .show-reviews-button {
            color: var(--dark-primary, #4A90E2);
        }
        
        /* Estilos para a √∫ltima avalia√ß√£o */
        .last-review {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color, #e5e7eb);
        }
        
        body.dark-theme .last-review {
            border-color: var(--dark-border, #2d3748);
        }
        
        .last-review-content {
            background: var(--accent-color, #e0eaff);
            padding: 0.75rem;
            border-radius: 8px;
        }
        
        body.dark-theme .last-review-content {
            background: var(--dark-accent, #1E293B);
        }
        
        .last-review .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .last-review .review-author {
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-color, #1f2937);
        }
        
        body.dark-theme .last-review .review-author {
            color: var(--dark-text, #e2e8f0);
        }
        
        .last-review .review-date {
            font-size: 0.75rem;
            color: var(--text-light, #6b7280);
        }
        
        body.dark-theme .last-review .review-date {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .last-review .review-stars {
            margin-bottom: 0.5rem;
        }
        
        .last-review .review-text {
            font-size: 0.875rem;
            color: var(--text-light, #4b5563);
            margin: 0;
            line-height: 1.4;
        }
        
        body.dark-theme .last-review .review-text {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .no-reviews {
            font-size: 0.875rem;
            color: var(--text-light, #6b7280);
            font-style: italic;
            text-align: center;
            padding: 0.5rem;
        }
        
        body.dark-theme .no-reviews {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .review-error {
            font-size: 0.875rem;
            color: #dc2626;
            text-align: center;
            padding: 0.5rem;
        }
        
        body.dark-theme .review-error {
            color: #f87171;
        }
        
        /* Estilos para a lista de todas as avalia√ß√µes */
        .all-reviews-list {
            max-height: 60vh;
            overflow-y: auto;
            padding-right: 1rem;
        }
        
        .all-reviews-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .all-reviews-list::-webkit-scrollbar-track {
            background: var(--accent-color, #e0eaff);
            border-radius: 4px;
        }
        
        .all-reviews-list::-webkit-scrollbar-thumb {
            background: var(--primary-color, #0055b3);
            border-radius: 4px;
        }
        
        body.dark-theme .all-reviews-list::-webkit-scrollbar-track {
            background: var(--dark-accent, #1E293B);
        }
        
        body.dark-theme .all-reviews-list::-webkit-scrollbar-thumb {
            background: var(--dark-primary, #4A90E2);
        }
        
        .review-item-full {
            background: var(--accent-color, #e0eaff);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        body.dark-theme .review-item-full {
            background: var(--dark-accent, #1E293B);
        }
        
        .review-item-full:last-child {
            margin-bottom: 0;
        }
        
        .review-item-full .review-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .review-item-full .review-author {
            font-weight: 600;
            color: var(--text-color, #1f2937);
        }
        
        body.dark-theme .review-item-full .review-author {
            color: var(--dark-text, #e2e8f0);
        }
        
        .review-item-full .review-date {
            font-size: 0.875rem;
            color: var(--text-light, #6b7280);
        }
        
        body.dark-theme .review-item-full .review-date {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .review-item-full .review-stars {
            margin-bottom: 0.5rem;
        }
        
        .review-item-full .review-text {
            color: var(--text-light, #4b5563);
            line-height: 1.5;
        }
        
        body.dark-theme .review-item-full .review-text {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .view-all-reviews-btn {
            display: inline-flex;
            align-items: center;
            background: none;
            border: none;
            color: var(--primary-color, #0055b3);
            font-size: 0.875rem;
            cursor: pointer;
            padding: 0.25rem 0;
            margin-top: 0.5rem;
            transition: color 0.3s ease;
        }
        
        body.dark-theme .view-all-reviews-btn {
            color: var(--dark-primary, #4A90E2);
        }
        
        .view-all-reviews-btn:hover {
            text-decoration: underline;
        }
        
        .view-all-reviews-btn i {
            margin-left: 0.25rem;
        }
        
        /* Estilos para o Chat */
        .chat-container {
            background: var(--background-color, #fff);
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 400px;
            margin-bottom: 2rem;
        }
        
        body.dark-theme .chat-container {
            background: var(--dark-card, #1e1e2d);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages::-webkit-scrollbar {
            width: 6px;
        }
        
        .chat-messages::-webkit-scrollbar-track {
            background: var(--accent-color, #e0eaff);
            border-radius: 3px;
        }
        
        .chat-messages::-webkit-scrollbar-thumb {
            background: var(--primary-color, #0055b3);
            border-radius: 3px;
        }
        
        body.dark-theme .chat-messages::-webkit-scrollbar-track {
            background: var(--dark-accent, #1E293B);
        }
        
        body.dark-theme .chat-messages::-webkit-scrollbar-thumb {
            background: var(--dark-primary, #4A90E2);
        }
        
        .chat-message {
            padding: 0.75rem 1rem;
            border-radius: 12px;
            margin-bottom: 0.75rem;
            max-width: 80%;
            position: relative;
            word-break: break-word;
        }
        
        .chat-message.sent {
            background-color: var(--primary-color, #0055b3);
            color: white;
            align-self: flex-end;
            margin-left: auto;
            border-bottom-right-radius: 4px;
        }
        
        .chat-message.received {
            background-color: var(--accent-color, #e0eaff);
            color: var(--text-color, #1f2937);
            align-self: flex-start;
            margin-right: auto;
            border-bottom-left-radius: 4px;
        }
        
        body.dark-theme .chat-message.sent {
            background-color: var(--dark-primary, #4A90E2);
        }
        
        body.dark-theme .chat-message.received {
            background-color: var(--dark-accent, #1E293B);
            color: var(--dark-text, #e2e8f0);
        }
        
        .chat-message .sender-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }
        
        .chat-message .message-text {
            margin: 0;
            line-height: 1.4;
        }
        
        .chat-message .message-time {
            font-size: 0.7rem;
            text-align: right;
            margin-top: 0.25rem;
            opacity: 0.8;
        }
        
        .chat-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light, #6b7280);
            height: 100%;
            font-size: 0.9rem;
        }
        
        body.dark-theme .chat-loading {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .chat-loading i {
            margin-right: 0.5rem;
        }
        
        .chat-input-container {
            display: flex;
            padding: 0.75rem;
            border-top: 1px solid var(--border-color, #d1d5db);
            background-color: var(--background-color, #fff);
        }
        
        body.dark-theme .chat-input-container {
            border-color: var(--dark-border, #2d3748);
            background-color: var(--dark-card, #1e1e2d);
        }
        
        #chatMessageInput {
            flex: 1;
            border: 1px solid var(--border-color, #d1d5db);
            border-radius: 8px;
            padding: 0.75rem;
            resize: none;
            background-color: var(--input-bg, #f9fafb);
            color: var(--text-color, #1f2937);
            font-family: 'Inter', sans-serif;
            transition: border-color 0.3s ease;
        }
        
        body.dark-theme #chatMessageInput {
            border-color: var(--dark-border, #2d3748);
            background-color: var(--dark-input-bg, #1a1a2e);
            color: var(--dark-text, #e2e8f0);
        }
        
        #chatMessageInput:focus {
            outline: none;
            border-color: var(--primary-color, #0055b3);
            box-shadow: 0 0 0 2px rgba(0, 85, 179, 0.1);
        }
        
        body.dark-theme #chatMessageInput:focus {
            border-color: var(--dark-primary, #4A90E2);
            box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
        }
        
        .chat-send-btn {
            margin-left: 0.75rem;
            background-color: var(--primary-color, #0055b3);
            color: white;
            border: none;
            border-radius: 8px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        body.dark-theme .chat-send-btn {
            background-color: var(--dark-primary, #4A90E2);
        }
        
        .chat-send-btn:hover {
            background-color: var(--primary-hover, #0066d6);
            transform: translateY(-2px);
        }
        
        .chat-date-separator {
            text-align: center;
            margin: 1rem 0;
            position: relative;
            font-size: 0.75rem;
            color: var(--text-light, #6b7280);
        }
        
        body.dark-theme .chat-date-separator {
            color: var(--dark-text-light, #94a3b8);
        }
        
        .chat-date-separator:before,
        .chat-date-separator:after {
            content: '';
            position: absolute;
            height: 1px;
            background-color: var(--border-color, #d1d5db);
            top: 50%;
            width: calc(50% - 60px);
        }
        
        .chat-date-separator:before {
            left: 0;
        }
        
        .chat-date-separator:after {
            right: 0;
        }
        
        body.dark-theme .chat-date-separator:before,
        body.dark-theme .chat-date-separator:after {
            background-color: var(--dark-border, #2d3748);
        }
        
        .system-message {
            text-align: center;
            color: var(--text-light, #6b7280);
            font-size: 0.8rem;
            margin: 0.5rem 0;
            font-style: italic;
        }
        
        body.dark-theme .system-message {
            color: var(--dark-text-light, #94a3b8);
        }

        .accessibility-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .accessibility-option {
            position: relative;
            cursor: pointer;
        }

        .accessibility-option input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
        }

        .option-content {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            background-color: var(--accent-color, #e0eaff);
            border: 2px solid transparent;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .option-content i {
            font-size: 1.5rem;
            color: var(--primary-color, #0055b3);
        }

        .option-content span {
            font-size: 0.9rem;
            color: var(--text-color, #1f2937);
        }

        .accessibility-option:hover .option-content {
            background-color: var(--primary-color, #0055b3);
        }

        .accessibility-option:hover .option-content i,
        .accessibility-option:hover .option-content span {
            color: white;
        }

        .accessibility-option input:checked + .option-content {
            background-color: var(--primary-color, #0055b3);
            border-color: var(--primary-color, #0055b3);
        }

        .accessibility-option input:checked + .option-content i,
        .accessibility-option input:checked + .option-content span {
            color: white;
        }

        body.dark-theme .option-content {
            background-color: var(--dark-accent, #1E293B);
        }

        body.dark-theme .option-content i {
            color: var(--dark-primary, #4A90E2);
        }

        body.dark-theme .option-content span {
            color: var(--dark-text, #e2e8f0);
        }

        body.dark-theme .accessibility-option:hover .option-content {
            background-color: var(--dark-primary, #4A90E2);
        }

        body.dark-theme .accessibility-option input:checked + .option-content {
            background-color: var(--dark-primary, #4A90E2);
            border-color: var(--dark-primary, #4A90E2);
        }

        .accessibility-features {
            display: flex;
            gap: 0.5rem;
            margin: 0.5rem 0;
            flex-wrap: wrap;
        }
        
        .accessibility-features i {
            font-size: 1.2rem;
            color: var(--primary-color, #0055b3);
            background: var(--accent-color, #e0eaff);
            padding: 0.5rem;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        body.dark-theme .accessibility-features i {
            color: var(--dark-primary, #4A90E2);
            background: var(--dark-accent, #1E293B);
        }
        
        .accessibility-features i:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .accessibility-ratings {
            display: grid;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .accessibility-rating-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: var(--accent-color, #e0eaff);
            border-radius: 8px;
        }

        body.dark-theme .accessibility-rating-item {
            background: var(--dark-accent, #1E293B);
        }

        .accessibility-rating-item i.feature-icon {
            font-size: 1.5rem;
            color: var(--primary-color, #0055b3);
            width: 2rem;
            text-align: center;
        }

        body.dark-theme .accessibility-rating-item i.feature-icon {
            color: var(--dark-primary, #4A90E2);
        }

        .accessibility-rating-item .feature-name {
            flex: 1;
            font-size: 0.9rem;
            color: var(--text-color, #1f2937);
        }

        body.dark-theme .accessibility-rating-item .feature-name {
            color: var(--dark-text, #e2e8f0);
        }

        .accessibility-rating-item .feature-stars {
            display: flex;
            gap: 0.25rem;
        }

        .accessibility-rating-item .feature-stars i {
            cursor: pointer;
            color: #d1d5db;
            transition: all 0.2s ease;
        }

        body.dark-theme .accessibility-rating-item .feature-stars i {
            color: #4b5563;
        }

        .accessibility-rating-item .feature-stars i:hover,
        .accessibility-rating-item .feature-stars i.fas {
            color: #fbbf24;
        }

        .feature-ratings {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color, #e5e7eb);
        }

        body.dark-theme .feature-ratings {
            border-color: var(--dark-border, #2d3748);
        }

        .feature-rating-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: var(--accent-color, #e0eaff);
            border-radius: 6px;
        }

        body.dark-theme .feature-rating-item {
            background: var(--dark-accent, #1E293B);
        }

        .feature-rating-item i {
            font-size: 1.2rem;
            color: var(--primary-color, #0055b3);
            width: 1.5rem;
            text-align: center;
        }

        body.dark-theme .feature-rating-item i {
            color: var(--dark-primary, #4A90E2);
        }

        .feature-rating-item span {
            flex: 1;
            font-size: 0.9rem;
            color: var(--text-color, #1f2937);
        }

        body.dark-theme .feature-rating-item span {
            color: var(--dark-text, #e2e8f0);
        }

        .feature-rating-item .feature-stars {
            display: flex;
            gap: 0.1rem;
        }

        .feature-rating-item .feature-stars i {
            font-size: 0.9rem;
            color: #fbbf24;
        }

        .feature-averages {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--accent-color, #e0eaff);
            border-radius: 8px;
        }

        body.dark-theme .feature-averages {
            background: var(--dark-accent, #1E293B);
        }

        .feature-average {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .feature-average:last-child {
            margin-bottom: 0;
        }

        .feature-average span {
            font-size: 0.9rem;
            color: var(--text-color, #1f2937);
        }

        body.dark-theme .feature-average span {
            color: var(--dark-text, #e2e8f0);
        }

        .feature-average .feature-stars {
            display: flex;
            gap: 0.1rem;
        }

        .feature-average .feature-stars i {
            font-size: 0.9rem;
            color: #fbbf24;
        }
    </style>
</head>
<body>
    <!-- Navigation (Adaptado do Site Base) -->
    <nav class="navbar" id="main-nav">
        <div class="container">
            <div class="navbar-content">
                <!-- Logo com nome -->
                <a href="../index.html" class="logo">
                    <img src="../public/images/logo.png" alt="WACS Logo" class="logo-dark">
                    <img src="../public/images/logo-light.png" alt="WACS Logo" class="logo-light">
                    <span class="logo-text">WACS</span>
                </a>

                <!-- Desktop Menu -->
                <div class="nav-menu">
                    <ul class="nav-links">
                        <li><a href="../index.html">Home</a></li>
                        <li><a href="dashboard.html" class="active">Dashboard</a></li>
                        <li><a href="profile.html">Perfil</a></li>
                    </ul>
                </div>

                <!-- Actions -->
                <div class="nav-actions">
                    <div class="theme-toggle">
                        <label class="switch">
                            <span class="sun"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><g fill="#ffd43b"><circle r="5" cy="12" cx="12"></circle><path d="m21 13h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2zm-17 0h-1a1 1 0 0 1 0-2h1a1 1 0 0 1 0 2zm13.66-5.66a1 1 0 0 1 -.66-.29 1 1 0 0 1 0-1.41l.71-.71a1 1 0 1 1 1.41 1.41l-.71.71a1 1 0 0 1 -.75.29zm-12.02 12.02a1 1 0 0 1 -.71-.29 1 1 0 0 1 0-1.41l.71-.66a1 1 0 0 1 1.41 1.41l-.71.71a1 1 0 0 1 -.7.24zm6.36-14.36a1 1 0 0 1 -1-1v-1a1 1 0 0 1 2 0v1a1 1 0 0 1 -1 1zm0 17a1 1 0 0 1 -1-1v-1a1 1 0 0 1 2 0v1a1 1 0 0 1 -1 1zm-5.66-14.66a1 1 0 0 1 -.7-.29l-.71-.71a1 1 0 0 1 1.41-1.41l.71.71a1 1 0 0 1 0 1.41 1 1 0 0 1 -.71.29zm12.02 12.02a1 1 0 0 1 -.7-.29l-.66-.71a1 1 0 0 1 1.36-1.36l.71.71a1 1 0 0 1 0 1.41 1 1 0 0 1 -.71.24z"></path></g></svg></span>
                            <span class="moon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="m223.5 32c-123.5 0-223.5 100.3-223.5 224s100 224 223.5 224c60.6 0 115.5-24.2 155.8-63.4 5-4.9 6.3-12.5 3.1-18.7s-10.1-9.7-17-8.5c-9.8 1.7-19.8 2.6-30.1 2.6-96.9 0-175.5-78.8-175.5-176 0-65.8 36-123.1 89.3-153.3 6.1-3.5 9.2-10.5 7.7-17.3s-7.3-11.9-14.3-12.5c-6.3-.5-12.6-.8-19-.8z"></path></svg></span>   
                            <input type="checkbox" class="input" id="theme-switch" aria-label="Toggle theme">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <button id="logoutBtn" class="logout-btn">Sair</button>
                </div>

                <!-- Mobile Menu Button -->
                <button class="menu-toggle" aria-label="Toggle menu">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>

            <!-- Mobile Menu Panel -->
            <div class="mobile-menu">
                <ul class="nav-links-mobile">
                    <li><a href="../index.html">Home</a></li>
                    <li><a href="dashboard.html" class="active">Dashboard</a></li>
                    <li><a href="profile.html">Perfil</a></li>
                </ul>
                <button id="logoutBtnMobile" class="download-btn-mobile">Sair</button>
            </div>
        </div>
    </nav>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <div class="container">
                <div class="user-info">
                    <a href="profile.html" class="user-avatar" id="userAvatar" title="Editar perfil">
                        <i class="fas fa-user"></i>
                    </a>
                    <div class="user-details">
                        <h2 id="userName">Carregando...</h2>
                        <p id="userEmail">Carregando...</p>
                        <a href="profile.html" class="profile-link">
                            <i class="fas fa-edit"></i> Editar perfil
                        </a>
                    </div>
                </div>
                
                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Locais Acess√≠veis</h3>
                            <p>125</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Colaboradores</h3>
                            <p>43</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-content">
                            <h3>Suas Contribui√ß√µes</h3>
                            <p>0</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-content">
            <div class="container">
                <div class="dashboard-section">
                    <h2>Mapa de Locais Acess√≠veis</h2>
                    <div class="map-container">
                        <p>O mapa ser√° carregado aqui</p>
                    </div>
                </div>
                
                <div class="dashboard-section">
                    <h2>Locais Recentes</h2>
                    <div class="locations-list">
                        <div class="location-card">
                            <div class="location-image">
                                <i class="fas fa-image"></i> Imagem do Local
                            </div>
                            <div class="location-details">
                                <h3>Shopping Center Registro</h3>
                                <p>Av. Clara Gianotti de Souza, 1500 - Registro, SP</p>
                                <p>Rampa de acesso, elevadores, banheiros adaptados</p>
                                <div class="location-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star-half-alt"></i>
                                    <span>4.5 (15 avalia√ß√µes)</span>
                                </div>
                            </div>
                        </div>
                        <div class="location-card">
                            <div class="location-image">
                                <i class="fas fa-image"></i> Imagem do Local
                            </div>
                            <div class="location-details">
                                <h3>Parque Municipal</h3>
                                <p>Rua dos Expedicion√°rios, 340 - Registro, SP</p>
                                <p>Caminhos acess√≠veis, √°rea de descanso, banheiros adaptados</p>
                                <div class="location-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="far fa-star"></i>
                                    <span>4.0 (8 avalia√ß√µes)</span>
                                </div>
                            </div>
                        </div>
                        <div class="location-card">
                            <div class="location-image">
                                <i class="fas fa-image"></i> Imagem do Local
                            </div>
                            <div class="location-details">
                                <h3>Terminal Rodovi√°rio</h3>
                                <p>Av. Prefeito Jonas Banks Leite, 300 - Registro, SP</p>
                                <p>Elevadores, piso t√°til, rampas de acesso</p>
                                <div class="location-rating">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="far fa-star"></i>
                                    <i class="far fa-star"></i>
                                    <span>3.2 (10 avalia√ß√µes)</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <a href="#" class="add-location-btn" id="openAddLocationModal">
                        <i class="fas fa-plus"></i> Adicionar Local Acess√≠vel
                    </a>
                </div>
                
                <!-- Nova se√ß√£o de Chat -->
                <div class="dashboard-section">
                    <h2>Chat Comunit√°rio</h2>
                    <div class="chat-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="chat-loading">
                                <i class="fas fa-spinner fa-pulse"></i> Carregando mensagens...
                            </div>
                        </div>
                        <div class="chat-input-container">
                            <textarea id="chatMessageInput" placeholder="Digite sua mensagem aqui..." rows="2"></textarea>
                            <button id="sendMessageBtn" class="chat-send-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para adicionar local acess√≠vel -->
    <div id="addLocationModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Adicionar Local Acess√≠vel</h2>
            <form id="addLocationForm">
                <div class="form-group">
                    <label for="locationName">Nome do Local</label>
                    <input type="text" id="locationName" required>
                </div>
                <div class="form-group">
                    <label for="locationAddress">Endere√ßo Completo</label>
                    <input type="text" id="locationAddress" required>
                </div>
                <div class="form-group">
                    <label for="locationMap">Selecione o Local no Mapa</label>
                    <div id="locationMap" class="location-map-selector"></div>
                    <p class="map-instructions">Clique no mapa para selecionar a localiza√ß√£o exata ou busque pelo endere√ßo acima</p>
                    <div class="coordinates-fields">
                        <div class="coordinate-field">
                            <label for="locationLat">Latitude</label>
                            <input type="text" id="locationLat" readonly>
                        </div>
                        <div class="coordinate-field">
                            <label for="locationLng">Longitude</label>
                            <input type="text" id="locationLng" readonly>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Recursos de Acessibilidade</label>
                    <div class="accessibility-options">
                        <label class="accessibility-option">
                            <input type="checkbox" name="accessibility" value="wheelchair" class="accessibility-checkbox">
                            <div class="option-content">
                                <i class="fas fa-wheelchair"></i>
                                <span>Cadeira de Rodas</span>
                            </div>
                        </label>
                        <label class="accessibility-option">
                            <input type="checkbox" name="accessibility" value="blind" class="accessibility-checkbox">
                            <div class="option-content">
                                <i class="fas fa-walking"></i>
                                <span>Piso T√°til</span>
                            </div>
                        </label>
                        <label class="accessibility-option">
                            <input type="checkbox" name="accessibility" value="deaf" class="accessibility-checkbox">
                            <div class="option-content">
                                <i class="fas fa-arrow-up-right-from-square"></i>
                                <span>Rampa</span>
                            </div>
                        </label>
                        <label class="accessibility-option">
                            <input type="checkbox" name="accessibility" value="elevator" class="accessibility-checkbox">
                            <div class="option-content">
                                <i class="fas fa-elevator"></i>
                                <span>Elevador</span>
                            </div>
                        </label>
                        <label class="accessibility-option">
                            <input type="checkbox" name="accessibility" value="parking" class="accessibility-checkbox">
                            <div class="option-content">
                                <i class="fas fa-restroom"></i>
                                <span>Banheiro Adaptado</span>
                            </div>
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="locationImage">URL da Imagem (opcional)</label>
                    <input type="url" id="locationImage" placeholder="https://exemplo.com/imagem.jpg">
                </div>
                <button type="submit" class="submit-btn">Salvar Local</button>
            </form>
        </div>
    </div>
    
    <!-- Modal para avalia√ß√£o de local -->
    <div id="rateLocationModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Avaliar Local</h2>
            <div id="locationToRate"></div>
            <form id="rateLocationForm">
                <input type="hidden" id="locationIdToRate">
                <div class="form-group">
                    <label>Avalia√ß√£o dos Recursos de Acessibilidade</label>
                    <div id="accessibilityRatings" class="accessibility-ratings">
                        <!-- Ser√° preenchido dinamicamente -->
                    </div>
                </div>
                <div class="form-group">
                    <label for="ratingComment">Coment√°rio (opcional)</label>
                    <textarea id="ratingComment" rows="3"></textarea>
                </div>
                <button type="submit" class="submit-btn">Enviar Avalia√ß√£o</button>
            </form>
        </div>
    </div>

    <!-- Modal para todos os coment√°rios -->
    <div id="allReviewsModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2>Avalia√ß√µes do Local</h2>
            <div id="locationReviewsInfo"></div>
            <div id="allReviewsList" class="all-reviews-list">
                <p>Carregando avalia√ß√µes...</p>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
    <script src="../public/js/theme.js"></script>
    <script src="../public/js/navbar-modern.js"></script>
    <script src="../public/js/env-config.js"></script>
    <script src="../public/js/firebase-dashboard.js"></script>
    
    <!-- Script para o modal e funcionalidade de adicionar locais -->
    <script>
        // Fun√ß√£o global para renderizar estrelas de avalia√ß√£o
        function renderRatingStars(rating, size = 'normal') {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let starsHTML = '';
            
            // Estrelas cheias
            for (let i = 0; i < fullStars; i++) {
                starsHTML += '<i class="fas fa-star"></i>';
            }
            
            // Meia estrela (se aplic√°vel)
            if (hasHalfStar) {
                starsHTML += '<i class="fas fa-star-half-alt"></i>';
            }
            
            // Estrelas vazias
            for (let i = 0; i < emptyStars; i++) {
                starsHTML += '<i class="far fa-star"></i>';
            }
            
            return starsHTML;
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Elementos do DOM
            const openModalBtn = document.getElementById('openAddLocationModal');
            const modal = document.getElementById('addLocationModal');
            const closeModalBtn = document.querySelector('.close-modal');
            const form = document.getElementById('addLocationForm');
            const locationsContainer = document.querySelector('.locations-list');
            
            // Elementos do modal de avalia√ß√£o
            const rateModal = document.getElementById('rateLocationModal');
            const rateForm = document.getElementById('rateLocationForm');
            const closeRateModalBtn = rateModal.querySelector('.close-modal');
            const ratingStars = document.querySelectorAll('.rating-stars i');
            const ratingValueInput = document.getElementById('ratingValue');
            
            // Vari√°veis para o mapa
            let map, marker, geocoder, placesService;
            let defaultLocation = { lat: -24.4874, lng: -47.8446 }; // Registro, SP como localiza√ß√£o padr√£o
            
            // Configura√ß√£o das estrelas de avalia√ß√£o
            ratingStars.forEach(star => {
                star.addEventListener('click', function() {
                    const rating = this.getAttribute('data-rating');
                    ratingValueInput.value = rating;
                    
                    // Atualizar visual das estrelas
                    ratingStars.forEach(s => {
                        const sRating = s.getAttribute('data-rating');
                        if (sRating <= rating) {
                            s.classList.remove('far');
                            s.classList.add('fas');
                        } else {
                            s.classList.remove('fas');
                            s.classList.add('far');
                        }
                    });
                });
            });
            
            // Inicializar o mapa quando o modal for aberto
            function initLocationMap() {
                if (!map && google && google.maps) {
                    const mapOptions = {
                        center: defaultLocation,
                        zoom: 15,
                        mapTypeId: google.maps.MapTypeId.ROADMAP,
                        mapTypeControl: false,
                        streetViewControl: false,
                        fullscreenControl: false
                    };
                    
                    map = new google.maps.Map(document.getElementById('locationMap'), mapOptions);
                    geocoder = new google.maps.Geocoder();
                    placesService = new google.maps.places.PlacesService(map);
                    
                    // Adicionar marcador inicial
                    marker = new google.maps.Marker({
                        position: defaultLocation,
                        map: map,
                        draggable: true,
                        animation: google.maps.Animation.DROP,
                    });
                    
                    // Atualizar campos quando o marcador for movido
                    marker.addListener('dragend', function() {
                        const position = marker.getPosition();
                        updateCoordinateFields(position.lat(), position.lng());
                        geocodePosition(position);
                    });
                    
                    // Permitir que o usu√°rio clique no mapa para mover o marcador
                    map.addListener('click', function(event) {
                        marker.setPosition(event.latLng);
                        updateCoordinateFields(event.latLng.lat(), event.latLng.lng());
                        geocodePosition(event.latLng);
                    });
                    
                    // Preencher os campos iniciais de coordenadas
                    updateCoordinateFields(defaultLocation.lat, defaultLocation.lng);
                    
                    // Configurar a busca por endere√ßo
                    const addressInput = document.getElementById('locationAddress');
                    addressInput.addEventListener('blur', function() {
                        if (addressInput.value.trim() !== '') {
                            geocodeAddress(addressInput.value);
                        }
                    });
                    
                    // Adicionar bot√£o Enter para buscar o endere√ßo
                    addressInput.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault(); // Prevenir o envio do formul√°rio
                            if (addressInput.value.trim() !== '') {
                                geocodeAddress(addressInput.value);
                            }
                        }
                    });
                }
            }
            
            // Fun√ß√£o para geocodificar um endere√ßo e atualizar o mapa
            function geocodeAddress(address) {
                if (geocoder) {
                    geocoder.geocode({ 'address': address }, function(results, status) {
                        if (status === google.maps.GeocoderStatus.OK) {
                            const location = results[0].geometry.location;
                            
                            map.setCenter(location);
                            marker.setPosition(location);
                            updateCoordinateFields(location.lat(), location.lng());
                            
                            // Zoom mais pr√≥ximo para endere√ßos espec√≠ficos
                            map.setZoom(17);
                        } else {
                            console.error('Geocode falhou: ' + status);
                            alert('N√£o foi poss√≠vel encontrar este endere√ßo. Por favor, tente outro ou selecione manualmente no mapa.');
                        }
                    });
                }
            }
            
            // Fun√ß√£o para geocodificar uma posi√ß√£o e atualizar o campo de endere√ßo
            function geocodePosition(latLng) {
                if (geocoder) {
                    geocoder.geocode({ 'location': latLng }, function(results, status) {
                        if (status === google.maps.GeocoderStatus.OK && results[0]) {
                            document.getElementById('locationAddress').value = results[0].formatted_address;
                        } else {
                            console.error('Geocode reverso falhou: ' + status);
                        }
                    });
                }
            }
            
            // Atualizar os campos de coordenadas
            function updateCoordinateFields(lat, lng) {
                document.getElementById('locationLat').value = lat.toFixed(6);
                document.getElementById('locationLng').value = lng.toFixed(6);
            }
            
            // Abrir modal
            openModalBtn.addEventListener('click', function(e) {
                e.preventDefault();
                modal.style.display = 'block';
                
                // Inicializar mapa ap√≥s um pequeno atraso para garantir que o DOM esteja pronto
                setTimeout(function() {
                    initLocationMap();
                    
                    // Redimensionar o mapa para garantir que seja exibido corretamente
                    if (map) {
                        google.maps.event.trigger(map, 'resize');
                        map.setCenter(marker.getPosition());
                    }
                }, 300);
            });
            
            // Fechar modal (X)
            closeModalBtn.addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            // Fechar modal ao clicar fora do conte√∫do
            window.addEventListener('click', function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
                if (event.target === rateModal) {
                    rateModal.style.display = 'none';
                }
            });
            
            // Renderizar estrelas de avalia√ß√£o baseado na pontua√ß√£o
            function renderRatingStars(rating, size = 'normal') {
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;
                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                
                let starsHTML = '';
                
                // Estrelas cheias
                for (let i = 0; i < fullStars; i++) {
                    starsHTML += '<i class="fas fa-star"></i>';
                }
                
                // Meia estrela (se aplic√°vel)
                if (hasHalfStar) {
                    starsHTML += '<i class="fas fa-star-half-alt"></i>';
                }
                
                // Estrelas vazias
                for (let i = 0; i < emptyStars; i++) {
                    starsHTML += '<i class="far fa-star"></i>';
                }
                
                return starsHTML;
            }
            
            // Fun√ß√£o para formatar texto de avalia√ß√£o (plural/singular)
            function formatReviewText(count) {
                if (count === 0) return "Sem avalia√ß√µes";
                if (count === 1) return "1 avalia√ß√£o";
                return `${count} avalia√ß√µes`;
            }
            
            // Fun√ß√£o para carregar avalia√ß√µes de um local espec√≠fico
            function loadLocationReviews(locationId, container) {
                firebase.firestore().collection('reviews')
                    .where('locationId', '==', locationId)
                    .orderBy('createdAt', 'desc')
                    .limit(3)
                    .get()
                    .then((querySnapshot) => {
                        if (querySnapshot.empty) {
                            container.innerHTML = '<p>Nenhuma avalia√ß√£o ainda. Seja o primeiro a avaliar!</p>';
                            return;
                        }
                        
                        let reviewsHTML = '';
                        
                        querySnapshot.forEach((doc) => {
                            const review = doc.data();
                            const date = review.createdAt ? new Date(review.createdAt.toDate()) : new Date();
                            const formattedDate = date.toLocaleDateString('pt-BR');
                            
                            reviewsHTML += `
                                <div class="review-item">
                                    <div class="review-header">
                                        <span class="review-author">${review.userName}</span>
                                        <span class="review-date">${formattedDate}</span>
                                    </div>
                                    <div class="review-stars">
                                        ${renderRatingStars(review.rating)}
                                    </div>
                                    ${review.comment ? `<p class="review-text">${review.comment}</p>` : ''}
                                </div>
                            `;
                        });
                        
                        container.innerHTML = reviewsHTML;
                    })
                    .catch((error) => {
                        console.error('Erro ao carregar avalia√ß√µes:', error);
                        container.innerHTML = '<p>Erro ao carregar avalia√ß√µes. Por favor, tente novamente mais tarde.</p>';
                    });
            }
            
            // Fun√ß√£o para abrir o modal de avalia√ß√£o
            function openRateModal(locationId, locationName, locationAddress) {
                // Limpar formul√°rio anterior
                rateForm.reset();
                ratingStars.forEach(s => {
                    s.classList.remove('fas');
                    s.classList.add('far');
                });
                
                // Preencher informa√ß√µes do local a ser avaliado
                document.getElementById('locationIdToRate').value = locationId;
                document.getElementById('locationToRate').innerHTML = `
                    <h3>${locationName}</h3>
                    <p>${locationAddress}</p>
                `;

                // Buscar informa√ß√µes do local para obter os recursos de acessibilidade
                firebase.firestore().collection('accessibleLocations').doc(locationId).get()
                    .then((doc) => {
                        if (doc.exists) {
                            const location = doc.data();
                            const accessibilityFeatures = location.accessibilityFeatures || [];
                            
                            // Mapear recursos para √≠cones e nomes
                            const featureMap = {
                                'wheelchair': { icon: 'fa-wheelchair', name: 'Cadeira de Rodas' },
                                'blind': { icon: 'fa-walking', name: 'Piso T√°til' },
                                'deaf': { icon: 'fa-arrow-up-right-from-square', name: 'Rampa' },
                                'elevator': { icon: 'fa-elevator', name: 'Elevador' },
                                'parking': { icon: 'fa-restroom', name: 'Banheiro Adaptado' }
                            };

                            // Criar HTML para cada recurso
                            const ratingsHTML = accessibilityFeatures.map(feature => {
                                const featureInfo = featureMap[feature];
                                if (!featureInfo) return '';

                                return `
                                    <div class="accessibility-rating-item">
                                        <i class="fas ${featureInfo.icon} feature-icon"></i>
                                        <span class="feature-name">${featureInfo.name}</span>
                                        <div class="feature-stars" data-feature="${feature}">
                                            <i class="far fa-star" data-rating="1"></i>
                                            <i class="far fa-star" data-rating="2"></i>
                                            <i class="far fa-star" data-rating="3"></i>
                                            <i class="far fa-star" data-rating="4"></i>
                                            <i class="far fa-star" data-rating="5"></i>
                                            <input type="hidden" name="feature_rating_${feature}" value="">
                                        </div>
                                    </div>
                                `;
                            }).join('');

                            // Atualizar o container de avalia√ß√µes
                            const accessibilityRatingsContainer = document.getElementById('accessibilityRatings');
                            if (accessibilityRatingsContainer) {
                                accessibilityRatingsContainer.innerHTML = ratingsHTML;

                                // Adicionar eventos para as estrelas de cada recurso
                                document.querySelectorAll('.feature-stars').forEach(starsContainer => {
                                    const stars = starsContainer.querySelectorAll('i');
                                    const input = starsContainer.querySelector('input');
                                    
                                    stars.forEach(star => {
                                        star.addEventListener('click', function() {
                                            const rating = this.getAttribute('data-rating');
                                            input.value = rating;
                                            
                                            // Atualizar visual das estrelas
                                            stars.forEach(s => {
                                                const sRating = s.getAttribute('data-rating');
                                                if (sRating <= rating) {
                                                    s.classList.remove('far');
                                                    s.classList.add('fas');
                                                } else {
                                                    s.classList.remove('fas');
                                                    s.classList.add('far');
                                                }
                                            });
                                        });
                                    });
                                });
                            }
                        }
                    })
                    .catch((error) => {
                        console.error('Erro ao carregar informa√ß√µes do local:', error);
                    });
                
                // Abrir modal
                rateModal.style.display = 'block';
            }
            
            // Adicionar evento de submit para o formul√°rio de avalia√ß√£o
            rateForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Verificar se o usu√°rio est√° autenticado
                const user = firebase.auth().currentUser;
                if (!user) {
                    alert('Voc√™ precisa estar logado para avaliar um local.');
                    return;
                }
                
                // Obter valores do formul√°rio
                const locationId = document.getElementById('locationIdToRate').value;
                const comment = document.getElementById('ratingComment').value;
                
                // Coletar avalia√ß√µes dos recursos de acessibilidade
                const featureRatings = {};
                document.querySelectorAll('.feature-stars').forEach(starsContainer => {
                    const feature = starsContainer.getAttribute('data-feature');
                    const rating = parseInt(starsContainer.querySelector('input').value);
                    if (rating) {
                        featureRatings[feature] = rating;
                    }
                });

                // Validar se todas as op√ß√µes de acessibilidade foram avaliadas
                const location = await firebase.firestore().collection('accessibleLocations').doc(locationId).get();
                const accessibilityFeatures = location.data().accessibilityFeatures || [];
                const missingRatings = accessibilityFeatures.filter(feature => !featureRatings[feature]);

                if (missingRatings.length > 0) {
                    alert('Por favor, avalie todos os recursos de acessibilidade dispon√≠veis.');
                    return;
                }

                // Calcular a m√©dia das avalia√ß√µes de acessibilidade
                const ratings = Object.values(featureRatings);
                const averageRating = ratings.reduce((sum, rating) => sum + rating, 0) / ratings.length;
                
                // Preparar objeto de avalia√ß√£o
                const reviewData = {
                    locationId: locationId,
                    userId: user.uid,
                    userName: user.displayName || user.email.split('@')[0],
                    rating: parseFloat(averageRating.toFixed(1)), // M√©dia arredondada para 1 casa decimal
                    featureRatings: featureRatings,
                    comment: comment,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // Salvar avalia√ß√£o no Firestore
                firebase.firestore().collection('reviews').add(reviewData)
                    .then(() => {
                        // Atualizar a m√©dia de avalia√ß√µes do local
                        updateLocationRating(locationId);
                        
                        // Fechar modal e mostrar confirma√ß√£o
                        rateModal.style.display = 'none';
                        alert('Avalia√ß√£o enviada com sucesso!');
                    })
                    .catch((error) => {
                        console.error('Erro ao adicionar avalia√ß√£o:', error);
                        alert('Ocorreu um erro ao enviar sua avalia√ß√£o. Por favor, tente novamente.');
                    });
            });
            
            // Fun√ß√£o para atualizar a m√©dia de avalia√ß√µes de um local
            function updateLocationRating(locationId) {
                firebase.firestore().collection('reviews')
                    .where('locationId', '==', locationId)
                    .get()
                    .then((querySnapshot) => {
                        // Calcular m√©dia das avalia√ß√µes
                        let totalRating = 0;
                        let reviewCount = querySnapshot.size;
                        
                        querySnapshot.forEach((doc) => {
                            totalRating += doc.data().rating;
                        });
                        
                        const averageRating = reviewCount > 0 ? totalRating / reviewCount : 0;
                        
                        // Atualizar o documento do local
                        firebase.firestore().collection('accessibleLocations').doc(locationId).update({
                            rating: parseFloat(averageRating.toFixed(1)),
                            reviewCount: reviewCount
                        })
                        .then(() => {
                            // Atualizar a UI, recarregando os locais
                            loadLocations();
                        })
                        .catch((error) => {
                            console.error('Erro ao atualizar avalia√ß√£o do local:', error);
                        });
                    })
                    .catch((error) => {
                        console.error('Erro ao carregar avalia√ß√µes:', error);
                    });
            }
            
            // Adicionar local ao enviar o formul√°rio
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Verificar se o usu√°rio est√° autenticado
                const user = firebase.auth().currentUser;
                if (!user) {
                    alert('Voc√™ precisa estar logado para adicionar um local.');
                    return;
                }
                
                // Obter valores do formul√°rio
                const name = document.getElementById('locationName').value;
                const address = document.getElementById('locationAddress').value;
                const imageUrl = document.getElementById('locationImage').value || 'https://via.placeholder.com/300x150?text=Local+Acess√≠vel';
                const lat = parseFloat(document.getElementById('locationLat').value);
                const lng = parseFloat(document.getElementById('locationLng').value);
                
                // Coletar op√ß√µes de acessibilidade selecionadas
                const accessibilityOptions = Array.from(document.querySelectorAll('.accessibility-checkbox:checked'))
                    .map(checkbox => checkbox.value);
                
                // Validar se pelo menos uma op√ß√£o de acessibilidade foi selecionada
                if (accessibilityOptions.length === 0) {
                    alert('Por favor, selecione pelo menos uma op√ß√£o de acessibilidade.');
                    return;
                }
                
                // Validar coordenadas
                if (isNaN(lat) || isNaN(lng)) {
                    alert('Por favor, selecione um local v√°lido no mapa.');
                    return;
                }
                
                // Preparar objeto para o Firestore
                const locationData = {
                    name: name,
                    address: address,
                    accessibilityFeatures: accessibilityOptions,
                    imageUrl: imageUrl,
                    location: new firebase.firestore.GeoPoint(lat, lng),
                    userId: user.uid,
                    userName: user.displayName || user.email.split('@')[0],
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    rating: 0,
                    reviewCount: 0
                };
                
                // Salvar no Firestore
                firebase.firestore().collection('accessibleLocations').add(locationData)
                    .then((docRef) => {
                        // Adicionar o ID do documento aos dados
                        locationData.id = docRef.id;
                        
                        // Atualizar a UI
                        addLocationToUI(locationData);
                        
                        // Resetar o formul√°rio e fechar o modal
                        form.reset();
                        modal.style.display = 'none';
                        
                        // Mostrar mensagem de sucesso
                        alert('Local adicionado com sucesso!');
                        
                        // Atualizar contador de contribui√ß√µes do usu√°rio
                        updateUserContributionCount();
                        
                        // Atualizar o mapa principal (se dispon√≠vel)
                        if (typeof updateMainMap === 'function') {
                            updateMainMap();
                        }
                    })
                    .catch((error) => {
                        console.error('Erro ao adicionar local:', error);
                        alert('Ocorreu um erro ao adicionar o local. Por favor, tente novamente.');
                    });
            });
            
            // Fun√ß√£o para adicionar um novo local √† interface
            function addLocationToUI(location) {
                const locationCard = document.createElement('div');
                locationCard.className = 'location-card';
                locationCard.dataset.id = location.id;
                
                // Calcular ou usar a avalia√ß√£o existente
                const rating = location.rating || 0;
                const reviewCount = location.reviewCount || 0;
                
                locationCard.innerHTML = `
                    <div class="location-image">
                        ${location.imageUrl.includes('placeholder') 
                            ? '<i class="fas fa-image"></i> Imagem do Local' 
                            : `<img src="${location.imageUrl}" alt="${location.name}">`}
                    </div>
                    <div class="location-details">
                        <h3>${location.name}</h3>
                        <p>${location.address}</p>
                        <div class="accessibility-features">
                            ${(location.accessibilityFeatures || []).map(feature => {
                                const icons = {
                                    'wheelchair': '<i class="fas fa-wheelchair" title="Cadeira de Rodas"></i>',
                                    'blind': '<i class="fas fa-walking" title="Piso T√°til"></i>',
                                    'deaf': '<i class="fas fa-arrow-up-right-from-square" title="Rampa"></i>',
                                    'elevator': '<i class="fas fa-elevator" title="Elevador"></i>',
                                    'parking': '<i class="fas fa-restroom" title="Banheiro Adaptado"></i>'
                                };
                                return icons[feature] || '';
                            }).join(' ')}
                        </div>
                        <div class="location-rating">
                            ${renderRatingStars(rating)}
                            <span>${rating.toFixed(1)} (${formatReviewText(reviewCount)})</span>
                        </div>
                        <button class="rate-button" data-id="${location.id}" data-name="${location.name}" data-address="${location.address}">
                            <i class="fas fa-star"></i> Avaliar Local
                        </button>
                        <div class="last-review" id="last-review-${location.id}">
                            <p>Carregando √∫ltima avalia√ß√£o...</p>
                        </div>
                        ${reviewCount > 0 ? `
                            <button class="view-all-reviews-btn" data-id="${location.id}" data-name="${location.name}">
                                Ver todas as avalia√ß√µes <i class="fas fa-chevron-right"></i>
                            </button>
                        ` : ''}
                    </div>
                `;
                
                // Adicionar no in√≠cio da lista
                if (locationsContainer.firstChild) {
                    locationsContainer.insertBefore(locationCard, locationsContainer.firstChild);
                } else {
                    locationsContainer.appendChild(locationCard);
                }
                
                // Adicionar evento ao bot√£o de avalia√ß√£o
                const rateButton = locationCard.querySelector('.rate-button');
                if (rateButton) {
                    rateButton.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        const name = this.getAttribute('data-name');
                        const address = this.getAttribute('data-address');
                        openRateModal(id, name, address);
                    });
                }
                
                // Adicionar evento ao bot√£o de ver todas as avalia√ß√µes
                const viewAllReviewsBtn = locationCard.querySelector('.view-all-reviews-btn');
                if (viewAllReviewsBtn) {
                    viewAllReviewsBtn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        const name = this.getAttribute('data-name');
                        openAllReviewsModal(id, name);
                    });
                }
                
                // Carregar a √∫ltima avalia√ß√£o
                loadLastReview(location.id);
            }
            
            // Fun√ß√£o para carregar a √∫ltima avalia√ß√£o de um local
            function loadLastReview(locationId) {
                const lastReviewContainer = document.getElementById(`last-review-${locationId}`);
                
                firebase.firestore().collection('reviews')
                    .where('locationId', '==', locationId)
                    .get()
                    .then((querySnapshot) => {
                        if (querySnapshot.empty) {
                            lastReviewContainer.innerHTML = '<p class="no-reviews">Nenhuma avalia√ß√£o ainda. Seja o primeiro a avaliar!</p>';
                            return;
                        }
                        
                        // Ordenar as avalia√ß√µes em mem√≥ria
                        const reviews = querySnapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        
                        // Ordenar por data de cria√ß√£o (mais recente primeiro)
                        reviews.sort((a, b) => {
                            const dateA = a.createdAt ? a.createdAt.toDate() : new Date(0);
                            const dateB = b.createdAt ? b.createdAt.toDate() : new Date(0);
                            return dateB - dateA;
                        });
                        
                        const review = reviews[0]; // Pegar a mais recente
                        const date = review.createdAt ? new Date(review.createdAt.toDate()) : new Date();
                        const formattedDate = date.toLocaleDateString('pt-BR');

                        lastReviewContainer.innerHTML = `
                            <div class="last-review-content">
                                <div class="review-header">
                                    <span class="review-author">${review.userName}</span>
                                    <span class="review-date">${formattedDate}</span>
                                </div>
                                <div class="review-stars">
                                    ${renderRatingStars(review.rating)}
                                </div>
                                ${review.comment ? `<p class="review-text">${review.comment}</p>` : ''}
                            </div>
                        `;
                    })
                    .catch((error) => {
                        console.error('Erro ao carregar √∫ltima avalia√ß√£o:', error);
                        lastReviewContainer.innerHTML = '<p class="review-error">Erro ao carregar avalia√ß√£o</p>';
                    });
            }
            
            // Fun√ß√£o para carregar locais do Firestore
            function loadLocations() {
                firebase.firestore().collection('accessibleLocations')
                    .orderBy('createdAt', 'desc')
                    .limit(6)
                    .get()
                    .then((querySnapshot) => {
                        // Limpar o container de locais
                        locationsContainer.innerHTML = '';
                        
                        // Verificar se h√° locais
                        if (querySnapshot.empty) {
                            locationsContainer.innerHTML = '<p class="no-locations">Nenhum local acess√≠vel cadastrado ainda. Seja o primeiro a contribuir!</p>';
                            return;
                        }
                        
                        // Adicionar cada local √† UI
                        querySnapshot.forEach((doc) => {
                            const locationData = doc.data();
                            locationData.id = doc.id;
                            addLocationToUI(locationData);
                        });
                    })
                    .catch((error) => {
                        console.error('Erro ao carregar locais:', error);
                        locationsContainer.innerHTML = '<p class="load-error">Erro ao carregar locais. Por favor, recarregue a p√°gina.</p>';
                    });
            }
            
            // Fun√ß√£o para atualizar o contador de contribui√ß√µes do usu√°rio
            function updateUserContributionCount() {
                const user = firebase.auth().currentUser;
                if (!user) return;
                
                firebase.firestore().collection('accessibleLocations')
                    .where('userId', '==', user.uid)
                    .get()
                    .then((querySnapshot) => {
                        const contributionCount = querySnapshot.size;
                        const contributionsElement = document.querySelector('.stat-card:nth-child(3) .stat-content p');
                        if (contributionsElement) {
                            contributionsElement.textContent = contributionCount;
                        }
                    })
                    .catch((error) => {
                        console.error('Erro ao atualizar contagem de contribui√ß√µes:', error);
                    });
            }
            
            // Inicializar: carregar locais quando o usu√°rio estiver autenticado
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    loadLocations();
                    updateUserContributionCount();
                }
            });
        });
    </script>
    
    <!-- Auth state navbar handling -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get navbar elements
            const navLinks = document.querySelector('.nav-links');
            const navLinksMobile = document.querySelector('.nav-links-mobile');
            
            // Remove unnecessary links from authenticated pages
            const removeUnnecessaryLinks = () => {
                // Function to safely remove links that shouldn't be visible on authenticated pages
                const removeLink = (parentElement, hrefValue) => {
                    const links = parentElement.querySelectorAll(`a[href="${hrefValue}"]`);
                    links.forEach(link => {
                        const listItem = link.parentElement;
                        if (listItem && listItem.tagName === 'LI') {
                            listItem.remove();
                        }
                    });
                };
                
                // Remove these links as they don't make sense in an authenticated context or are handled elsewhere
                removeLink(navLinks, '#mapa');
                removeLink(navLinks, '#contribuir');
                removeLink(navLinksMobile, '#mapa');
                removeLink(navLinksMobile, '#contribuir');
            };
            
            // Clean up navbar for authenticated users
            auth.onAuthStateChanged(function(user) {
                if (user) {
                    // User is authenticated, clean up navbar
                    removeUnnecessaryLinks();
                } else {
                    // User is not authenticated, redirect to login page
                    // This is already handled in firebase-dashboard.js
                }
            });
        });
    </script>
    
    <!-- Google Maps Script (carregado dinamicamente com a API key do env-config.js) -->
    <script>
        // Fun√ß√£o para carregar a API do Google Maps com a chave das vari√°veis de ambiente
        function loadGoogleMapsScript() {
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=${window.ENV.GOOGLE_MAPS_API_KEY}&libraries=places&callback=initMap`;
            script.async = true;
            script.defer = true;
            document.head.appendChild(script);
        }
        
        // Vari√°veis globais para os mapas
        window.mainMap = undefined;
        window.mainMapMarkers = [];
        let mainMapMarkers = window.mainMapMarkers; // manter refer√™ncia para compatibilidade
        
        // Inicializar mapa principal
        function initMap() {
            // --- Adiciona sincroniza√ß√£o do tema do mapa principal ---
            const darkMapStyles = [
                { elementType: "geometry", stylers: [{ color: "#242f3e" }] },
                { elementType: "labels.text.stroke", stylers: [{ color: "#242f3e" }] },
                { elementType: "labels.text.fill", stylers: [{ color: "#746855" }] },
                { featureType: "administrative.locality", elementType: "labels.text.fill", stylers: [{ color: "#d59563" }] },
                { featureType: "poi", elementType: "labels.text.fill", stylers: [{ color: "#d59563" }] },
                { featureType: "poi.park", elementType: "geometry", stylers: [{ color: "#263c3f" }] },
                { featureType: "poi.park", elementType: "labels.text.fill", stylers: [{ color: "#6b9a76" }] },
                { featureType: "road", elementType: "geometry", stylers: [{ color: "#38414e" }] },
                { featureType: "road", elementType: "geometry.stroke", stylers: [{ color: "#212a37" }] },
                { featureType: "road", elementType: "labels.text.fill", stylers: [{ color: "#9ca5b3" }] },
                { featureType: "road.highway", elementType: "geometry", stylers: [{ color: "#746855" }] },
                { featureType: "road.highway", elementType: "geometry.stroke", stylers: [{ color: "#1f2835" }] },
                { featureType: "road.highway", elementType: "labels.text.fill", stylers: [{ color: "#f3d19c" }] },
                { featureType: "transit", elementType: "geometry", stylers: [{ color: "#2f3948" }] },
                { featureType: "transit.station", elementType: "labels.text.fill", stylers: [{ color: "#d59563" }] },
                { featureType: "water", elementType: "geometry", stylers: [{ color: "#17263c" }] },
                { featureType: "water", elementType: "labels.text.fill", stylers: [{ color: "#515c6d" }] },
                { featureType: "water", elementType: "labels.text.stroke", stylers: [{ color: "#17263c" }] }
            ];
            // Listener para troca de tema
            document.removeEventListener('themechange', window._wacs_main_map_theme_listener);
            window._wacs_main_map_theme_listener = function() {
                if (window.mainMap) {
                    const isDark = document.body.classList.contains('dark-theme');
                    window.mainMap.setOptions({ styles: isDark ? darkMapStyles : [] });
                }
            };
            document.addEventListener('themechange', window._wacs_main_map_theme_listener);

            // Configura√ß√£o do mapa principal na dashboard
            const mapContainer = document.querySelector('.map-container');
            if (mapContainer) {
                mapContainer.innerHTML = ''; // Limpar o conte√∫do de placeholder
                
                const mapOptions = {
                    center: { lat: -24.4874, lng: -47.8446 }, // Registro, SP
                    zoom: 14,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    mapTypeControl: true,
                    streetViewControl: false,
                    fullscreenControl: true
                };
                
                window.mainMap = new google.maps.Map(mapContainer, mapOptions);
                
                // Aplica o estilo correto no carregamento inicial
                const isDark = document.body.classList.contains('dark-theme');
                window.mainMap.setOptions({ styles: isDark ? darkMapStyles : [] });
                
                // Carregar os locais acess√≠veis para o mapa
                loadLocationsForMap();
            }
        }
        
        // Fun√ß√£o para carregar os locais no mapa principal
        function loadLocationsForMap() {
            if (!window.mainMap) return;
            
            // Limpar marcadores existentes
            window.mainMapMarkers.forEach(marker => marker.setMap(null));
            window.mainMapMarkers = [];
            
            // Buscar locais no Firestore
            firebase.firestore().collection('accessibleLocations')
                .get()
                .then((querySnapshot) => {
                    const bounds = new google.maps.LatLngBounds();
                    let hasLocations = false;
                    
                    querySnapshot.forEach((doc) => {
                        const data = doc.data();
                        if (data.location) {
                            hasLocations = true;
                            const position = {
                                lat: data.location.latitude,
                                lng: data.location.longitude
                            };
                            
                            // Criar marcador
                            const marker = new google.maps.Marker({
                                position: position,
                                map: window.mainMap,
                                title: data.name,
                                animation: google.maps.Animation.DROP
                            });
                            
                            // Formata√ß√£o para rating
                            const rating = data.rating || 0;
                            const reviewCount = data.reviewCount || 0;
                            let ratingStars = '';
                            
                            // Gerar estrelas HTML
                            for (let i = 1; i <= 5; i++) {
                                if (i <= Math.floor(rating)) {
                                    ratingStars += '<i class="fas fa-star" style="color: #fbbf24;"></i>';
                                } else if (i === Math.ceil(rating) && rating % 1 !== 0) {
                                    ratingStars += '<i class="fas fa-star-half-alt" style="color: #fbbf24;"></i>';
                                } else {
                                    ratingStars += '<i class="far fa-star" style="color: #d1d5db;"></i>';
                                }
                            }
                            
                            // Criar janela de informa√ß√µes
                            const infowindow = new google.maps.InfoWindow({
                                content: `
                                    <div class="map-info-window">
                                        <h3>${data.name}</h3>
                                        <p>${data.address}</p>
                                        <p><strong>Recursos:</strong> ${data.features}</p>
                                        <div style="margin-top:8px;">
                                            ${ratingStars}
                                            <span style="margin-left:6px;font-size:13px;">
                                                ${rating.toFixed(1)} (${reviewCount} ${reviewCount === 1 ? 'avalia√ß√£o' : 'avalia√ß√µes'})
                                            </span>
                                        </div>
                                    </div>
                                `
                            });
                            
                            // Abrir janela de informa√ß√µes ao clicar no marcador
                            marker.addListener('click', function() {
                                infowindow.open(window.mainMap, marker);
                            });
                            
                            // Adicionar √† cole√ß√£o de marcadores
                            window.mainMapMarkers.push(marker);
                            
                            // Extender os limites do mapa para incluir este marcador
                            bounds.extend(position);
                        }
                    });
                    
                    // Ajustar o mapa para mostrar todos os marcadores
                    if (hasLocations) {
                        window.mainMap.fitBounds(bounds);
                        
                        // Definir um zoom m√°ximo para n√£o aproximar demais se houver apenas um ou poucos locais
                        const listener = google.maps.event.addListener(window.mainMap, 'idle', function() {
                            if (window.mainMap.getZoom() > 16) {
                                window.mainMap.setZoom(16);
                            }
                            google.maps.event.removeListener(listener);
                        });
                    }
                })
                .catch((error) => {
                    console.error('Erro ao carregar locais para o mapa:', error);
                });
        }
        
        // Fun√ß√£o para atualizar o mapa principal (chamada ap√≥s adicionar um novo local)
        function updateMainMap() {
            if (mainMap) {
                loadLocationsForMap();
            }
        }
        
        // Aguardar o carregamento das vari√°veis de ambiente antes de carregar o Google Maps
        if (window.ENV && window.ENV.GOOGLE_MAPS_API_KEY) {
            loadGoogleMapsScript();
        } else {
            window.addEventListener('DOMContentLoaded', function() {
                if (window.ENV && window.ENV.GOOGLE_MAPS_API_KEY) {
                    loadGoogleMapsScript();
                } else {
                    console.error('Google Maps API key n√£o encontrada nas vari√°veis de ambiente');
                }
            });
        }
    </script>

    <script>
        // ... existing code ...
        function addLocationToUI(location) {
            const locationCard = document.createElement('div');
            locationCard.className = 'location-card';
            locationCard.dataset.id = location.id;
            
            // Calcular ou usar a avalia√ß√£o existente
            const rating = location.rating || 0;
            const reviewCount = location.reviewCount || 0;
            
            locationCard.innerHTML = `
                <div class="location-image">
                    ${location.imageUrl.includes('placeholder') 
                        ? '<i class="fas fa-image"></i> Imagem do Local' 
                        : `<img src="${location.imageUrl}" alt="${location.name}">`}
                </div>
                <div class="location-details">
                    <h3>${location.name}</h3>
                    <p>${location.address}</p>
                    <div class="accessibility-features">
                        ${(location.accessibilityFeatures || []).map(feature => {
                            const icons = {
                                'wheelchair': '<i class="fas fa-wheelchair" title="Cadeira de Rodas"></i>',
                                'blind': '<i class="fas fa-walking" title="Piso T√°til"></i>',
                                'deaf': '<i class="fas fa-arrow-up-right-from-square" title="Rampa"></i>',
                                'elevator': '<i class="fas fa-elevator" title="Elevador"></i>',
                                'parking': '<i class="fas fa-restroom" title="Banheiro Adaptado"></i>'
                            };
                            return icons[feature] || '';
                        }).join(' ')}
                    </div>
                    <div class="location-rating">
                        ${renderRatingStars(rating)}
                        <span>${rating.toFixed(1)} (${formatReviewText(reviewCount)})</span>
                    </div>
                    <button class="rate-button" data-id="${location.id}" data-name="${location.name}" data-address="${location.address}">
                        <i class="fas fa-star"></i> Avaliar Local
                    </button>
                    <div class="last-review" id="last-review-${location.id}">
                        <p>Carregando √∫ltima avalia√ß√£o...</p>
                    </div>
                    ${reviewCount > 0 ? `
                        <button class="view-all-reviews-btn" data-id="${location.id}" data-name="${location.name}">
                            Ver todas as avalia√ß√µes <i class="fas fa-chevron-right"></i>
                        </button>
                    ` : ''}
                </div>
            `;
            
            // Adicionar no in√≠cio da lista
            if (locationsContainer.firstChild) {
                locationsContainer.insertBefore(locationCard, locationsContainer.firstChild);
            } else {
                locationsContainer.appendChild(locationCard);
            }
            
            // Adicionar evento ao bot√£o de avalia√ß√£o
            const rateButton = locationCard.querySelector('.rate-button');
            if (rateButton) {
                rateButton.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const name = this.getAttribute('data-name');
                    const address = this.getAttribute('data-address');
                    openRateModal(id, name, address);
                });
            }
            
            // Adicionar evento ao bot√£o de ver todas as avalia√ß√µes
            const viewAllReviewsBtn = locationCard.querySelector('.view-all-reviews-btn');
            if (viewAllReviewsBtn) {
                viewAllReviewsBtn.addEventListener('click', function() {
                    const id = this.getAttribute('data-id');
                    const name = this.getAttribute('data-name');
                    openAllReviewsModal(id, name);
                });
            }
            
            // Carregar a √∫ltima avalia√ß√£o
            loadLastReview(location.id);
        }

        // Fun√ß√£o para abrir o modal com todas as avalia√ß√µes
        function openAllReviewsModal(locationId, locationName) {
            const modal = document.getElementById('allReviewsModal');
            const reviewsList = document.getElementById('allReviewsList');
            const locationInfo = document.getElementById('locationReviewsInfo');
            
            // Limpar conte√∫do anterior
            reviewsList.innerHTML = '<p>Carregando avalia√ß√µes...</p>';
            
            // Mostrar informa√ß√µes do local
            locationInfo.innerHTML = `
                <h3>${locationName}</h3>
                <p>Carregando avalia√ß√µes...</p>
            `;
            
            // Abrir modal
            modal.style.display = 'block';
            
            // Carregar todas as avalia√ß√µes
            firebase.firestore().collection('reviews')
                .where('locationId', '==', locationId)
                .get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        reviewsList.innerHTML = '<p class="no-reviews">Nenhuma avalia√ß√£o ainda.</p>';
                        locationInfo.innerHTML = `
                            <h3>${locationName}</h3>
                            <p>Nenhuma avalia√ß√£o ainda.</p>
                        `;
                        return;
                    }
                    
                    // Ordenar avalia√ß√µes por data
                    const reviews = querySnapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    })).sort((a, b) => {
                        const dateA = a.createdAt ? a.createdAt.toDate() : new Date(0);
                        const dateB = b.createdAt ? b.createdAt.toDate() : new Date(0);
                        return dateB - dateA;
                    });
                    
                    // Calcular m√©dias
                    // Atualizar informa√ß√µes do local
                    const averageRating = reviews.reduce((acc, review) => acc + review.rating, 0) / reviews.length;
                    locationInfo.innerHTML = `
                        <h3>${locationName}</h3>
                        <p>M√©dia: ${averageRating.toFixed(1)} (${reviews.length} ${reviews.length === 1 ? 'avalia√ß√£o' : 'avalia√ß√µes'})</p>
                    `;
                    
                    // Renderizar lista de avalia√ß√µes
                    reviewsList.innerHTML = reviews.map(review => {
                        const date = review.createdAt ? new Date(review.createdAt.toDate()) : new Date();
                        const formattedDate = date.toLocaleDateString('pt-BR');
                        
                        return `
                            <div class="review-item-full">
                                <div class="review-header">
                                    <span class="review-author">${review.userName}</span>
                                    <span class="review-date">${formattedDate}</span>
                                </div>
                                <div class="review-stars">
                                    ${renderRatingStars(review.rating)}
                                </div>
                                ${review.comment ? `<p class="review-text">${review.comment}</p>` : ''}
                            </div>
                        `;
                    }).join('');
                })
                .catch((error) => {
                    console.error('Erro ao carregar avalia√ß√µes:', error);
                    reviewsList.innerHTML = '<p class="review-error">Erro ao carregar avalia√ß√µes. Por favor, tente novamente.</p>';
                });
        }

        // Adicionar evento para fechar o modal de todas as avalia√ß√µes
        document.addEventListener('DOMContentLoaded', function() {
            const allReviewsModal = document.getElementById('allReviewsModal');
            const closeAllReviewsModal = allReviewsModal.querySelector('.close-modal');
            
            closeAllReviewsModal.addEventListener('click', function() {
                allReviewsModal.style.display = 'none';
            });
            
            window.addEventListener('click', function(event) {
                if (event.target === allReviewsModal) {
                    allReviewsModal.style.display = 'none';
                }
            });
        });
        // ... existing code ...
    </script>

    <script>
        // ... existing code ...
        
        // Fun√ß√£o para formatar os textos de avalia√ß√£o
        function formatReviewText(count) {
            if (count === 0) return "Sem avalia√ß√µes";
            if (count === 1) return "1 avalia√ß√£o";
            return `${count} avalia√ß√µes`;
        }
        
        // Verificar se o usu√°rio est√° logado e inicializar chat
        document.addEventListener('DOMContentLoaded', function() {
            // Refer√™ncia para os elementos do chat
            const chatMessages = document.getElementById('chatMessages');
            const messageInput = document.getElementById('chatMessageInput');
            const sendButton = document.getElementById('sendMessageBtn');
            
            // Vari√°veis para o Firebase
            let db, auth, currentUser;
            
            // Inicializar Firebase para o chat
            function initChat() {
                if (firebase) {
                    auth = firebase.auth();
                    db = firebase.firestore();
                    
                    // Observar estado de autentica√ß√£o
                    auth.onAuthStateChanged(function(user) {
                        if (user) {
                            currentUser = user;
                            loadChatMessages();
                            setupChatListeners();
                        } else {
                            // Usu√°rio n√£o logado
                            chatMessages.innerHTML = `
                                <div class="system-message">
                                    <p>Voc√™ precisa estar logado para usar o chat.</p>
                            </div>
                        `;
                        }
                    });
                }
            }
            
            // Carregar mensagens existentes
            function loadChatMessages() {
                db.collection('chatMessages')
                    .orderBy('timestamp', 'desc')
                    .limit(50)
                    .get()
                    .then((querySnapshot) => {
                        // Limpar mensagens existentes
                        chatMessages.innerHTML = '';
                        
                        // Organizar mensagens em ordem cronol√≥gica
                        const messages = [];
                        querySnapshot.forEach((doc) => {
                            messages.push({id: doc.id, ...doc.data()});
                        });
                        
                        // Exibir em ordem cronol√≥gica (da mais antiga para a mais recente)
                        messages.reverse().forEach(message => {
                            addMessageToUI(message);
                        });
                        
                        // Rolar para a mensagem mais recente
                        scrollToBottom();
                        
                        // Se n√£o houver mensagens, mostrar mensagem inicial
                        if (messages.length === 0) {
                            chatMessages.innerHTML = `
                                <div class="system-message">
                                    <p>Ainda n√£o h√° mensagens. Seja o primeiro a iniciar uma conversa!</p>
                                </div>
                            `;
                        }
                    })
                    .catch((error) => {
                        console.error("Erro ao carregar mensagens do chat:", error);
                        chatMessages.innerHTML = `
                            <div class="system-message">
                                <p>Erro ao carregar mensagens. Por favor, tente novamente.</p>
                        </div>
                    `;
                    });
            }
            
            // Configurar ouvinte para novas mensagens
            function setupChatListeners() {
                // Ouvir por novas mensagens em tempo real
                db.collection('chatMessages')
                    .orderBy('timestamp', 'desc')
                    .limit(1)
                    .onSnapshot((snapshot) => {
                        snapshot.docChanges().forEach((change) => {
                            if (change.type === 'added') {
                                const message = {id: change.doc.id, ...change.doc.data()};
                                
                                // Verificar se a mensagem j√° est√° na UI (para evitar duplicatas)
                                if (!document.getElementById(`message-${message.id}`)) {
                                    addMessageToUI(message);
                                    scrollToBottom();
                                }
                            }
                        });
                    }, (error) => {
                        console.error("Erro no listener de mensagens:", error);
                    });
                
                // Adicionar evento para o bot√£o de enviar
                sendButton.addEventListener('click', sendMessage);
                
                // Adicionar evento para enviar mensagem com Enter (n√£o shift+enter)
                messageInput.addEventListener('keydown', function(event) {
                    if (event.key === 'Enter' && !event.shiftKey) {
                        event.preventDefault();
                        sendMessage();
                    }
                });
            }
            
            // Enviar nova mensagem
            function sendMessage() {
                const messageText = messageInput.value.trim();
                
                if (messageText && currentUser) {
                    // Desabilitar bot√£o para evitar envios duplicados
                    sendButton.disabled = true;
                    
                    // Criar objeto de mensagem
                    const message = {
                        text: messageText,
                        userId: currentUser.uid,
                        userName: currentUser.displayName || 'Usu√°rio',
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        userEmail: currentUser.email
                    };
                    
                    // Salvar no Firestore
                    db.collection('chatMessages')
                        .add(message)
                        .then(() => {
                            // Limpar input ap√≥s envio bem-sucedido
                            messageInput.value = '';
                            sendButton.disabled = false;
                        })
                        .catch((error) => {
                            console.error("Erro ao enviar mensagem:", error);
                            alert("Erro ao enviar mensagem. Tente novamente.");
                            sendButton.disabled = false;
                        });
                }
            }
            
            // Adicionar mensagem √† interface
            function addMessageToUI(message) {
                const isCurrentUser = currentUser && message.userId === currentUser.uid;
                const messageElement = document.createElement('div');
                messageElement.className = `chat-message ${isCurrentUser ? 'sent' : 'received'}`;
                messageElement.id = `message-${message.id}`;
                
                // Formatar hor√°rio
                const timestamp = message.timestamp ? message.timestamp.toDate() : new Date();
                const timeFormatted = timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                // Criar HTML da mensagem
                messageElement.innerHTML = `
                    ${!isCurrentUser ? `<div class="sender-name">${message.userName || 'Usu√°rio'}</div>` : ''}
                    <p class="message-text">${escapeHtml(message.text)}</p>
                    <div class="message-time">${timeFormatted}</div>
                `;
                
                // Adicionar ao container
                chatMessages.appendChild(messageElement);
            }
            
            // Fun√ß√£o auxiliar para escapar HTML (evitar inje√ß√£o de c√≥digo)
            function escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }
            
            // Rolar chat para a √∫ltima mensagem
            function scrollToBottom() {
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Inicializar chat se o Firebase estiver dispon√≠vel
            if (window.firebase) {
                initChat();
            }
        });
    </script>
</body>
</html> 